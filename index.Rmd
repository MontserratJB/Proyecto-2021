---
title: "Presupuestos Participativos"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
```


```{r import, warning=FALSE, message=FALSE}
# Paquete para manipulación de datos
library(dplyr)

# Paquete para manejo de datos vectoriales
library(sf)

# Paquetes para manejo de datos raster
library(terra)
library(raster)

# Paquete para mapas interactivos
library(leaflet)

# Paquetes para graficación
library(ggplot2)
library(plotly)

library(DT)
```


```{r cargadatos}
# Lectura de una capa vectorial (GeoJSON) de provincias proyectos de Montes de Oca
proyectos <-
  st_read(
    "https://raw.githubusercontent.com/MontserratJB/Proyecto-2021/master/Presupuestos.geojson",
    quiet = TRUE
  )

# Lectura de una capa vectorial (GeoJSON) de distritos de Montes de Oca
distritos <-
  st_read(
    "https://raw.githubusercontent.com/MontserratJB/Proyecto-2021/master/Distritos.geojson",
    quiet = TRUE
  )

# Lectura de un archivo CSV con datos de Presupuestos participativos en Montes de Oca
presupuesto <-
  st_read(
    "/vsicurl/https://raw.githubusercontent.com/MontserratJB/Proyecto-2021/master/Pres_part.csv",
    options = c(
      "X_POSSIBLE_NAMES=decimalLongitude",
      "Y_POSSIBLE_NAMES=decimalLatitude"
    ),
    quiet = TRUE
  )

```

Column {data-width=650}
-----------------------------------------------------------------------

### Tabla de datos Presupuesto

```{r tabla}
#Tabla
proyectos %>%
  st_drop_geometry() %>%
  select(No_Proyect, Inversión, Presupuest, Distrito) %>%
datatable()

```

### Mapa

```{r}

```

Column {data-width=350}
-----------------------------------------------------------------------

### Grafico Presupuesto

```{r grafico-presupuestos}
presupuesto %>%
  group_by(Distrito) %>%
  summarize(suma_Presupuesto = sum(as.numeric(Presupuesto))) %>%
  plot_ly(x = ~ Distrito,
          y = ~ suma_Presupuesto,
          type="bar", color = I("green")) %>%
  layout(title = "Presupuestos participativos por Distrito",
         xaxis = list(title = "Distrito"),
         yaxis = list(title = "Monto en Colones"))

```

### Gráfico Distritos

```{r proyectos}
# Gráfico de estacionalidad
presupuesto %>%
  group_by(Distrito) %>%
  summarize(suma_proyectos = n()) %>%
  plot_ly(x = ~ Distrito,
          y = ~ suma_proyectos,
          type="bar", mode="markers", fill = "tozeroy", fillcolor = "green") %>%
  layout(title = "Proyectos por Distrito",
         xaxis = list(title = "Distritos"),
         yaxis = list(title = "Número de proyectos"))
```

